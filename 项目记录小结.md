# 网易云音乐移动端 项目记录小结

目录

1 [项目功能介绍](#1)

2 [后台上传管理页面](#2)

  - [2.1 上传歌曲成功自动高亮新建列表区 + 填入相关歌曲信息到 歌曲详情区](#2.1)

  - [2.2 上传歌曲成功 存入数据库](#2.2)

  - [2.3 新建歌曲上传后 表单内容清空 + 歌曲列表区显示歌曲名称](#2.3)


## <span id="1"> 一 项目介绍功能 </span>

1 Q: 整个项目有哪些页面，分别有哪些功能

A: 整个项目大致分为以下部分:

S1 后台歌曲上传管理页面: 上传并管理 歌曲资源的增删改查

  

## <span id="2"> 二 后台上传管理页面 </span>

1 Q: 后台上传管理页面有哪些功能

A: S1 支持 拖拽/点击 上传并存储歌曲到 七牛bucket: 歌曲上传区 + 七牛官方SDK (前后端配合)

S2 支持 数据库记录 已上传歌曲: 歌曲详情区 + leanCloud官方文档

S3 支持 显示已上传的歌曲信息: 歌曲列表区 + 歌曲详情区


### <span id="2.1"> 2.1 上传歌曲成功自动高亮新建列表区 + 填入相关歌曲信息到 歌曲详情区 </span>

1 Q: 如何实现 上传歌曲成功后，自动高亮新建列表区 + 填入相关歌曲信息到 歌曲详情区

A: S1 利用发布-订阅模式，上传歌曲成功后，返回歌曲相关信息数据 + 调用订阅提供的回调函数

S2 新建列表区 和 歌曲详情区 订阅上传事件，并提供回调函数

S3.1 新建列表区订阅的 回调函数:  激活列表区的高亮.actice

S3.2 歌曲列表区订阅的 回调函数:  去除当前所有高亮的列表项

S3.3 歌曲详情区订阅的 回调函数:  用获取的数据，替换渲染 占位的详情区表单的value值

S3.4 替换渲染的方法是，获取占位内容 + 创建占位符变量数组&遍历替换template里的占位符 + 重新渲染显示


### <span id="2.2"> 2.2 上传歌曲成功 存入数据库 + 用存入数据渲染页面 </span>

1 Q: 如何实现 新建歌曲区表单上传后 数据存入数据库

A: S1 根据官方文档，引入 leadCloud的数据库初始化代码 initAV.js

S2 利用事件委托，监听表单的提交事件, 监听函数内部的功能有:

S2.1 阻止默认事件

S2.2 获取表单的输入元素-输入值 (制作关键词数组 + 遍历数组 + 存入对应的key-value)
 
`易错点: 获取表单value值时，用find方法结合遍历时，可以把变量传入到 find选择器中`

S2.3 调用model.create()方法,从而把数据存入数据库中


2 Q: model.create()方法的功能及 实现步骤是什么

A: S0 功能是 把获取的表单key-value对象 存入数据库中 + 提供新数据以给页面渲染

S1 新建一个nowData对象，用以 记录新数据

S2 根据leadCloud文档 存储语法，创建Song表单 + 遍历传入的数据对象，写入字段

S3 查看数据库返回的字段对象，获取表单数据 赋值存入到 nowData对象中


3 Q: 如何实现 用存入数据渲染页面

A: S1 数据库要能传出最新的数据对象 nowData—— 返回一个Promise对象

S2 contoller中 用最新的model里的最新表单数据 + 调用view里的render方法

`易错点: 遍历的表单key，渲染页面的key 要和数据库返回的 保持一致`



### <span id="2.3"> 2.3 新建歌曲上传后 表单内容清空 + 歌曲列表区显示歌曲名称 </span>

1 Q: 如何实现 新建歌曲上传后 表单内容清空

A: 保存数据库数据成功后，用空数据再次渲染页面即可

2 Q: 如何实现 新建歌曲上传后 歌曲列表区 新建一个li+显示歌曲名称

A: S1 保存数据成功后，songform.js 通过发布订阅， 发布create事件

S2 songlist.js 订阅create事件: model里push数据 + view用数据渲染页面

S3.1 渲染页面要 获取model传入的表单数据对象 数组
S3.2 遍历数组，创建相同个数的li DOM元素

S3.3 遍历li元素，插入到ul中
S3.4 因为每次提交表单，都会触发一次 对li数组的遍历，所以需要在遍历li之前，需要先清除ul已有的li
S3.5 添加active的类名 + 去除兄弟元素的.active 的思路同上